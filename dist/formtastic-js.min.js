/*! formtastic-js - v0.0.1 - 2015-08-02
* https://github.com/spodlecki/formtastic-js
* Copyright (c) 2015 Steven Podlecki; Licensed  */
(function(){_.mixin({isBlank:function(a){switch(typeof a){case"number":return _.isNaN(a);default:return _.isEmpty(a)}},isPresent:function(a){return!_.isBlank(a)}},{chain:!1})}).call(this),function(){var Form,base,base1,fn,key,ref,bind=function(a,b){return function(){return a.apply(b,arguments)}},hasProp={}.hasOwnProperty;this.Formtastic||(this.Formtastic={}),(base=this.Formtastic).Input||(base.Input={}),(base1=this.Formtastic).Inputs||(base1.Inputs={}),Form=function(){function Form(a,b,c){this.createNode=bind(this.createNode,this),this.label=bind(this.label,this),this.inputs=bind(this.inputs,this),this.input=bind(this.input,this),this.render=bind(this.render,this),this.attrs=b,this.el=form.apply(this,[b]),this.object=a,this.callback=c}var dom,form,merge_css_strings;return Form.builders={},Form.default_wrapper_tag="li",Form.default_wrapper_class="",Form.default_input_class="",Form.default_form_class="formtastic",Form.default_label_class="label",Form.default_input_type="string",Form.required_string="*",Form.default_hint_class="inline-hints",Form.default_hint_tag="p",Form.default_fieldset_inner_tag="ol",Form.default_form_action="javascript:void(0);",Form.template="<%= label %><%= input %><%= hint %>",Form.merge_css_strings=function(default_css,attrs,path){var other_css;try{if(other_css=eval("attrs."+path),!other_css)throw new Error("Go to default css.");return _.flatten([default_css,other_css]).join(" ")}catch(_error){return default_css}},merge_css_strings=Form.merge_css_strings,dom=function(a,b){var c,d,e;if(null==b&&(b=!1),!a.tag)throw new Error("Can't create a DOM Node without a tag.");c=document.createElement(a.tag),delete a.tag;for(d in a)hasProp.call(a,d)&&(e=a[d],"undefined"!=typeof e&&null!==e&&""!==e&&c.setAttribute(d,e));return b===!0?c:c.outerHTML},form=function(a){var b;return a.action||(a.action=a.url),b=merge_css_strings(this.constructor.default_form_class,a,"class"),delete a["class"],a=_.extend({tag:"form",action:this.constructor.default_form_action,"class":b},a),delete a.as,delete a.wrapper_html,delete a.input_html,delete a.label,delete a.url,delete a.label_html,delete a.hint,this.createNode(a,!0)},Form.prototype.render=function(){return this.el.innerHTML="",this.el.innerHTML=this.callback.apply(window,[this]),this.el.outerHTML},Form.prototype.input=function(a,b,c){if(!a)throw new Error("Required Parameter Missing: 'field'");return Formtastic.Input.Base.get_inputs_by_config(a,b,c||this.attrs.as)},Form.prototype.inputs=function(){var a,b;return b=_.first(arguments),a=_.last(arguments),new Formtastic.Inputs(b,a,this.attrs.as).render()},Form.prototype.label=function(a,b){var c,d,e;return a?(c=_.extend({required:!1,tag:"label","class":Formtastic.default_label_class},b),e=c.required,delete c.required,d=this.createNode(c,!0),d.innerHTML=a+(e?Formtastic.required_string:""),d.outerHTML):null},Form.createNode=function(){return dom.apply(Form,arguments)},Form.prototype.createNode=function(){return this.constructor.createNode.apply(this,arguments)},Form}(),ref=Formtastic.Inputs;for(key in ref)hasProp.call(ref,key)&&(fn=ref[key],Form.prototype[key]=fn);window.Formtastic=Form}.call(this),function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}};this.Formtastic||(this.Formtastic={}),(b=this.Formtastic).Input||(b.Input={}),(c=this.Formtastic).Inputs||(c.Inputs={}),a=function(){function a(a,b){this.generate=d(this.generate,this),this.wrapper=d(this.wrapper,this),this.hint=d(this.hint,this),this.generated_id=d(this.generated_id,this),this.input_value=d(this.input_value,this),this.input_name=d(this.input_name,this),this.input=d(this.input,this),this.label_name=d(this.label_name,this),this.label=d(this.label,this),this.render=d(this.render,this),this.createNode=d(this.createNode,this),b=_.extend({required:!1},b),this.field=a,this.attrs=b,this.as=b.as,this.required=b.required,this.prefix=b.prefix}var b,c,e,f;return e=Formtastic.merge_css_strings,c=function(a){return a.replace(/_/g," ").replace(/(\w+)/g,function(a){return a.charAt(0).toUpperCase()+a.slice(1)})},b=function(a){var b,c;return b=a.wrapper,c=_.template(Formtastic.template),b.innerHTML=c({input:a.input,label:a.label,hint:a.hint,attrs:this.attrs}),b.outerHTML},f=function(a,b){var c;return b=_.extend({},b),c=b.as,c?c:/^(.+\_)?password(\_.+)?$/.test(a)?"password":/^.+\_id$/.test(a)?"number":"undefined"!=typeof b.collection&&b.collection.length>0?"select":/^(.+)?(phone|fax)(\_.+)?$/.test(a)?"phone":/^(.+)?email(.+)?$/.test(a)?"email":/^(.+\_)?url(\_.+)?$/.test(a)?"url":/^(.+\_)?search(\_.+)?$/.test(a)?"search":Formtastic.default_input_type},a.get_inputs_by_config=function(a,b,c){var d,e;return d=f(a,b),b=_.extend({as:d,prefix:c},b),e=function(){switch(d){case"email":case"file":case"number":case"password":case"phone":case"string":case"url":case"search":return new Formtastic.Input.StringFieldHelper(a,b);case"hidden":return new Formtastic.Input.HiddenFieldHelper(a,b);case"text":return new Formtastic.Input.TextFieldHelper(a,b);case"datetime_picker":throw"TODO datetime_picker";case"boolean":case"bool":case"checkbox":case"check_box":return new Formtastic.Input.BooleanFieldHelper(a,b);case"date":throw"TODO date";case"date_picker":throw"TODO date_picker";case"radio":throw"TODO radio";case"range":throw"TODO range";case"select":return new Formtastic.Input.SelectFieldHelper(a,b);case"time":throw"TODO time";default:throw new Error("'"+d+"' is not a valid field type.")}}(),e.render()},a.prototype.createNode=function(){return Formtastic.createNode.apply(this,arguments)},a.prototype.render=function(){var a;return a={label:this.label(),input:this.input(),hint:this.hint(),wrapper:this.wrapper()},this.generate(a)},a.prototype.label=function(a){var b,c,d;if(!this.label_name())return null;b={tag:"label","class":e(Formtastic.default_label_class,this.attrs,"label_html.class"),"for":this.generated_id()};try{delete this.attrs.label_html["class"]}catch(f){}return d=_.extend(b,this.attrs.label_html),c=this.createNode(d,!0),c.innerHTML=this.label_name()+(this.required?Formtastic.required_string:""),a?c:c.outerHTML},a.prototype.label_name=function(){return this.attrs.label!==!1?this.attrs.label||c(this.field):void 0},a.prototype.input=function(a){var b,c,d;return b={placeholder:this.label_name(),tag:"input",type:"string"===this.as?"text":this.as,name:this.input_name(),required:this.required,"class":Formtastic.default_input_class,id:this.generated_id()},b=_.extend(b,a),this.required||delete b.required,d=_.extend(b,this.attrs.input_html),c=this.createNode(d,!0),c.outerHTML},a.prototype.input_name=function(){return this.attrs.input_html&&this.attrs.input_html.name?this.attrs.input_html.name:this.prefix?_.template("<%= prefix %>[<%= name %>]")({prefix:this.prefix,name:this.field}):_.template("<%= name %>")({prefix:this.prefix,name:this.field})},a.prototype.input_value=function(){return null},a.prototype.generated_id=function(){return this.attrs.id?this.attrs.id:_.compact([this.prefix,this.field]).join("_").replace(/\[|\]/,"_").replace(/\s/,"")},a.prototype.hint=function(){var a;return this.attrs.hint?(a=this.createNode({tag:Formtastic.default_hint_tag,"class":Formtastic.default_hint_class},!0),a.innerHTML=this.attrs.hint,a.outerHTML):null},a.prototype.wrapper=function(){var a,b,c;c=_.compact([this.as,Formtastic.default_wrapper_class,this.required?"required":"optional","input"]).join(" "),c=e(c,this.attrs,"wrapper_html.class");try{delete this.attrs.wrapper_html["class"]}catch(d){}return a={tag:Formtastic.default_wrapper_tag,"class":c,id:this.generated_id()+"_input"},b=_.extend(a,this.attrs.wrapper_html),this.createNode(b,!0)},a.prototype.generate=function(a){return b.apply(this,[a])},a}(),this.Formtastic.Input.Base=a}.call(this),function(){var a,b,c,d,e,f,g=function(a,b){return function(){return a.apply(b,arguments)}},h={}.hasOwnProperty;this.Formtastic||(this.Formtastic={}),(b=this.Formtastic).Input||(b.Input={}),(c=this.Formtastic).Inputs||(c.Inputs={}),a=function(){function a(a,b,c,d){this.namespace=g(this.namespace,this),this.inputs=g(this.inputs,this),this.input=g(this.input,this),this.container=g(this.container,this),this.legend=g(this.legend,this),this.fieldset=g(this.fieldset,this),this.render=g(this.render,this),this.createNode=g(this.createNode,this),_.isFunction(a)?this.options={}:_.isObject(a)?(a.name||(a.name=a.title),delete a.title,this.options=a):_.isString(a)?this.options={name:a}:this.options={},this.prefix=c,this.nested=d,_.isFunction(b)?this.cb=b:this.cb=null}return a.prototype.createNode=function(){return Formtastic.createNode.apply(this,arguments)},a.prototype.render=function(){var a,b,c,d;return b=this.fieldset(),a=this.container(),c=this.legend(),this.cb&&(a.innerHTML=this.cb.apply(window,[this]),b.innerHTML=c+a.outerHTML),this.nested?(d=this.createNode({tag:Formtastic.default_wrapper_tag},!0),d.innerHTML=b.outerHTML,d.outerHTML):b.outerHTML},a.prototype.fieldset=function(){var a,b;return b={tag:"fieldset","class":"inputs"},a=_.extend(b,this.options),this.createNode(a,!0)},a.prototype.legend=function(){var a;return this.options.name?(a=this.createNode({tag:"legend"},!0),a.innerHTML=this.options.name,a.outerHTML):""},a.prototype.container=function(){return this.createNode({tag:Formtastic.default_fieldset_inner_tag},!0)},a.prototype.input=function(a,b){if(!a)throw new Error("Required Parameter Missing: 'field'");return Formtastic.Input.Base.get_inputs_by_config(a,b,this.namespace())},a.prototype.inputs=function(){var a,b;return b=_.first(arguments),a=_.last(arguments),new Formtastic.Inputs(b,a,this.namespace(),!0).render()},a.prototype.namespace=function(){return this.options["for"]?_.template("<%= prefix %>[<%= name %>]")({prefix:this.prefix,name:this.options["for"]}):_.template("<%= name %>")({prefix:this.prefix})},a}(),f=Formtastic.Inputs;for(e in f)h.call(f,e)&&(d=f[e],a.prototype[e]=d);this.Formtastic.Inputs=a}.call(this),function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}},e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;this.Formtastic||(this.Formtastic={}),(b=this.Formtastic).Input||(b.Input={}),(c=this.Formtastic).Inputs||(c.Inputs={}),a=function(a){function b(){return this.input=d(this.input,this),this.label=d(this.label,this),b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.label=function(){return null},b.prototype.input=function(){var a,b,c,d,e,f,g;return a=function(a){return function(){try{return a.attrs.checked_value||a.attrs.value||a.attrs.input_html.value}catch(b){return 1}}}(this),c=function(a){return function(){return a.attrs.unchecked_value||"0"}}(this),b=function(a){return function(b){var d,e;return e=_.clone(a.attrs.input_html),e&&delete e.checked,delete b.required,d=_.extend(b,{type:"hidden",id:null,value:c()}),d=_.extend(d,e),a.createNode(d)}}(this),f={tag:"input",type:"checkbox",name:this.input_name(),required:this.required,id:this.generated_id(),value:a()},this.required||delete f.required,g=_.extend(_.clone(f),this.attrs.input_html),d=this.createNode(g),e=Formtastic.Input.Base.prototype.label.apply(this,[!0]),e.innerHTML=d+" "+this.label_name(),e.className="",b(_.clone(f))+e.outerHTML},b}(Formtastic.Input.Base),this.Formtastic.Input.BooleanFieldHelper=a,this.Formtastic.Inputs.check_box=function(a,b){return b=_.extend({input_html:{},attrs:b}),b.input_html.type="checkbox",this.input(a,b)}}.call(this),function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}},e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;this.Formtastic||(this.Formtastic={}),(b=this.Formtastic).Input||(b.Input={}),(c=this.Formtastic).Inputs||(c.Inputs={}),a=function(a){function b(){return this.wrapper=d(this.wrapper,this),this.label=d(this.label,this),b.__super__.constructor.apply(this,arguments)}return e(b,a),b.prototype.label=function(){return null},b.prototype.wrapper=function(){var a;return a=b.__super__.wrapper.apply(this,arguments),a.style="display: none;",a},b}(Formtastic.Input.Base),this.Formtastic.Input.HiddenFieldHelper=a,this.Formtastic.Inputs.hidden_field=function(a,b){return b=_.extend({as:"hidden"},b),this.input(a,b)}}.call(this),function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}},e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;this.Formtastic||(this.Formtastic={}),(b=this.Formtastic).Input||(b.Input={}),(c=this.Formtastic).Inputs||(c.Inputs={}),a=function(a){function b(a,c,e){if(this.input=d(this.input,this),"undefined"==typeof c.collection)throw new Error("Missing :collection for select box.");b.__super__.constructor.call(this,a,c,e)}return e(b,a),b.prototype.input=function(){var a,b,c,d,e,f,g,h;for(a=this.attrs.collection,b={tag:"select",name:this.input_name(),multiple:this.attrs.multiple,name:this.field,required:this.required,"class":this.constructor.default_input_class},e=_.extend(b,this.attrs.input_html),c=this.createNode(e,!0),h=function(a){return function(b){var c;return c=a.createNode({tag:"option"},!0),c.innerHTML=b.text,_.isArray(b)?(c.value=b[1],c.innerHTML=b[0]):_.isObject(b)?(c.value=b.value,c.innerHTML=b.text):(c.value=b,c.innerHTML=b),c.outerHTML}}(this),d=0,g=a.length;g>d;d++)f=a[d],c.innerHTML=c.innerHTML+h(f);return c.outerHTML},b}(Formtastic.Input.Base),this.Formtastic.Input.SelectFieldHelper=a,this.Formtastic.Inputs.select_field=function(a,b){return b=_.extend({},b),b.as="select",this.input(a,b)}}.call(this),function(){var a,b,c,d=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},e={}.hasOwnProperty;this.Formtastic||(this.Formtastic={}),(b=this.Formtastic).Input||(b.Input={}),(c=this.Formtastic).Inputs||(c.Inputs={}),a=function(a){function b(a,c,d){b.__super__.constructor.call(this,a,c,d)}return d(b,a),b}(Formtastic.Input.Base),this.Formtastic.Input.StringFieldHelper=a,this.Formtastic.Inputs.string_field=function(a,b){var c;return b=_.extend({input_html:{},attrs:b}),(c=b.input_html).type||(c.type="text"),this.input(a,b)}}.call(this),function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}},e=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f={}.hasOwnProperty;this.Formtastic||(this.Formtastic={}),(b=this.Formtastic).Input||(b.Input={}),(c=this.Formtastic).Inputs||(c.Inputs={}),a=function(a){function b(a,c,e){this.input=d(this.input,this),b.__super__.constructor.call(this,a,c,e)}return e(b,a),b.prototype.input=function(){var a,b,c,d;return a={placeholder:this.label_name(),tag:"textarea",type:"string"===this.as?"text":this.as,name:this.input_name(),required:this.required,"class":this.constructor.default_input_class,id:this.generated_id()},this.required||delete a.required,c=_.extend(a,this.attrs.input_html),d=c.value,delete c.value,delete c.type,delete c.as,b=this.createNode(c,!0),b.innerHTML=d,b.outerHTML},b}(Formtastic.Input.Base),this.Formtastic.Input.TextFieldHelper=a,this.Formtastic.Inputs.textarea_field=function(a,b){return b=_.extend({},b),b.as="text",this.input(a,b)}}.call(this);