/*! formtastic-js - v0.0.4 - 2015-08-04
* https://github.com/spodlecki/formtastic-js
* Copyright (c) 2015 Steven Podlecki; Licensed MIT */
(function(){var BooleanFieldHelper,Form,FormtasticActions,FormtasticHelpers,FormtasticInput,FormtasticInputBase,FormtasticInputs,HiddenFieldHelper,SelectFieldHelper,StringFieldHelper,TextFieldHelper,extend,hasProp={}.hasOwnProperty,bind=function(a,b){return function(){return a.apply(b,arguments)}},extend1=function(a,b){function c(){this.constructor=a}for(var d in b)hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};this.Formtastic||(this.Formtastic={}),FormtasticInput={},FormtasticInputs={},FormtasticHelpers={},extend=function(a,b){var c,d,e;e=[];for(d in a)hasProp.call(a,d)&&(c=a[d],e.push(b.prototype[d]=c));return e},_.mixin({isBlank:function(a){switch(typeof a){case"number":return _.isNaN(a);default:return _.isEmpty(a)}},isPresent:function(a){return!_.isBlank(a)}},{chain:!1}),FormtasticHelpers.action=function(a,b){var c,d,e,f,g;if(b=_.extend({},b),b=_.extend(b,b.button_html),b=_.extend(b,b.input_html),delete b.button_html,delete b.input_html,a=function(a){switch(a=a||"",a.toLowerCase()){case"reset":case"submit":case"cancel":return a.toLowerCase();default:return void 0}}(a),!a)throw new Error("Type required for action. submit|reset|cancel|commit");if(f=function(a,b){return b&&b.label?b.label:a?Formtastic.humanize(a):void 0}(a,b),e=function(a,b){var c;switch(c=a&&a.as){case"button":case"input":return c;case"btn":return"button";case"link":return"a";default:switch(b){case"reset":case"submit":return"input";case"cancel":return"a"}}}(b,a),g=function(a,b){return"submit"===a&&"a"===b?!1:"cancel"!==a||"input"!==b&&"button"!==b?!0:!1}(a,e),!g)throw new Error("Unsupported :as for '"+a+"'");return c=_.extend({tag:e,type:a},b),"a"===e&&delete c.type,delete c.as,d=this.createNode(c,!0),"button"===e?d.innerHTML=f:"a"===e?(d.innerHTML=f,d.href=b&&b.href||"javascript:window.history.back();"):d.value=f,d.outerHTML},FormtasticHelpers.cancel=function(a,b){var c;return c=_.extend({label:a},b),this.action("cancel",c)},FormtasticHelpers.check_box=function(a,b){return b=_.extend({as:"boolean"},b),this.input(a,b)},FormtasticHelpers.email_field=function(a,b){return b=_.extend({as:"email"},b),this.input(a,b,void 0,!0)},FormtasticHelpers.file_field=function(a,b){return b=_.extend({as:"file"},b),this.input(a,b,void 0,!0)},FormtasticHelpers.hidden_field=function(a,b){return b=_.extend({as:"hidden"},b),this.input(a,b,void 0,!0)},FormtasticHelpers.label=function(a,b){var c,d,e;return a?(c=_.extend({required:!1,tag:"label","class":Formtastic.default_label_class},b),e=c.required,delete c.required,d=this.createNode(c,!0),d.innerHTML=a+(e?Formtastic.required_string:""),d.outerHTML):null},FormtasticHelpers.number_field=function(a,b){return b=_.extend({as:"number"},b),this.input(a,b,void 0,!0)},FormtasticHelpers.password_field=function(a,b){return b=_.extend({as:"password"},b),this.input(a,b,void 0,!0)},FormtasticHelpers.reset=function(a,b){var c;return c=_.extend({label:a},b),this.action("reset",c)},FormtasticHelpers.search_field=function(a,b){return b=_.extend({as:"search"},b),this.input(a,b,void 0,!0)},FormtasticHelpers.select=function(a,b){return b=_.extend({as:"select"},b),this.input(a,b)},FormtasticHelpers.submit=function(a,b){var c;return c=_.extend({label:a},b),this.action("submit",c)},FormtasticHelpers.phone_field=FormtasticHelpers.telephone_field=function(a,b){return b=_.extend({as:"phone"},b),this.input(a,b,void 0,!0)},FormtasticHelpers.text_area=function(a,b){return b=_.extend({},b),b.as="text",this.input(a,b,void 0,!0)},FormtasticHelpers.text_field=function(a,b){return b=_.extend({as:"string"},b),this.input(a,b,void 0,!0)},FormtasticHelpers.url_field=function(a,b){return b=_.extend({as:"url"},b),this.input(a,b,void 0,!0)},Form=function(){function Form(a,b){this.createNode=bind(this.createNode,this),this.actions=bind(this.actions,this),this.inputs=bind(this.inputs,this),this.input=bind(this.input,this),this.render=bind(this.render,this),this.attrs=set_options(b),this.el=form.apply(this,[this.attrs]),this.object=a,this.callback=set_callback(_.last(arguments))}var dom,form,merge_css_strings,set_callback,set_options;return Form.builders={},Form.default_wrapper_tag="li",Form.default_wrapper_class="",Form.default_input_class="",Form.default_form_class="formtastic",Form.default_label_class="label",Form.default_input_type="string",Form.required_string="*",Form.default_hint_class="inline-hints",Form.default_hint_tag="p",Form.default_fieldset_inner_tag="ol",Form.default_form_action="#",Form.template="<%= label %><%= input %><%= hint %>",Form.merge_css_strings=function(default_css,attrs,path){var other_css;try{if(other_css=eval("attrs."+path),!other_css)throw new Error("Go to default css.");return _.flatten([default_css,other_css]).join(" ")}catch(_error){return default_css}},Form.humanize=function(a){return a.replace(/_/g," ").replace(/(\w+)/g,function(a){return a.charAt(0).toUpperCase()+a.slice(1)})},merge_css_strings=Form.merge_css_strings,dom=function(a,b){var c,d,e;if("undefined"==typeof b&&(b=!1),!a.tag)throw new Error("Can't create a DOM Node without a tag.");c=document.createElement(a.tag),delete a.tag;for(d in a)hasProp.call(a,d)&&(e=a[d],"undefined"!=typeof e&&null!==e&&""!==e&&c.setAttribute(d,e));return b===!0?c:c.outerHTML},form=function(a){var b;return a.action||(a.action=a.url),b=merge_css_strings(this.constructor.default_form_class,a,"class"),delete a["class"],a=_.extend({tag:"form",action:this.constructor.default_form_action,"class":b},a),delete a.as,delete a.wrapper_html,delete a.input_html,delete a.label,delete a.url,delete a.label_html,delete a.hint,this.createNode(a,!0)},set_options=function(a){return _.isFunction(a)?{}:_.isObject(a)?a:_.isString(a)?{as:a}:{}},set_callback=function(a){return _.isFunction(a)?a:null},Form.prototype.render=function(){return this.el.innerHTML="",this.el.innerHTML=this.callback.apply(window,[this]),this.el.outerHTML},Form.prototype.input=function(a,b,c,d){var e;if(!a)throw new Error("Required Parameter Missing: 'field'");return e=FormtasticInputBase.get_inputs_by_config(a,b,c||this.attrs&&this.attrs.as),d?e.input():e.render()},Form.prototype.inputs=function(){var a;return a=[],_.each(arguments,function(b){return function(c,d){return _.isString(c)&&d>0?a[d]=c||b.attrs&&b.attrs.as:a[d]=c}}(this)),_.isString(a[2])||a.push(this.attrs&&this.attrs.as),new FormtasticInputs(a[0],a[1],a[2],a[3],a[4],a[5]).render()},Form.prototype.actions=function(a,b,c,d){return _.isFunction(a)&&(b=a,a=void 0),new FormtasticActions(a,b,c||this.attrs&&this.attrs.as,d).render()},Form.createNode=function(){return dom.apply(Form,arguments)},Form.prototype.createNode=function(){return this.constructor.createNode.apply(this,arguments)},Form}(),extend(FormtasticHelpers,Form),this.Formtastic=Form,FormtasticInputBase=function(){function a(a,b){this.generate=bind(this.generate,this),this.wrapper=bind(this.wrapper,this),this.hint=bind(this.hint,this),this.generated_id=bind(this.generated_id,this),this.input_value=bind(this.input_value,this),this.input_name=bind(this.input_name,this),this.input=bind(this.input,this),this.label_name=bind(this.label_name,this),this._label_node=bind(this._label_node,this),this.render=bind(this.render,this),this.createNode=bind(this.createNode,this),b=_.extend({required:!1},b),this.field=a,this.attrs=b,this.as=b.as,this.required=b.required,this.prefix=b.prefix}var b,c,d;return c=Formtastic.merge_css_strings,b=function(a){var b,c;return b=a.wrapper,c=_.template(Formtastic.template),b.innerHTML=c({input:a.input,label:a.label,hint:a.hint,attrs:this.attrs}),b.outerHTML},d=function(a,b){var c;return b=_.extend({},b),c=b.as,c?c:/^(.+\_)?password(\_.+)?$/.test(a)?"password":/^.+\_id$/.test(a)?"number":"undefined"!=typeof b.collection&&b.collection.length>0?"select":/^(.+)?(phone|fax)(\_.+)?$/.test(a)?"phone":/^(.+)?email(.+)?$/.test(a)?"email":/^(.+\_)?url(\_.+)?$/.test(a)?"url":/^(.+\_)?search(\_.+)?$/.test(a)?"search":Formtastic.default_input_type},a.get_inputs_by_config=function(a,b,c){var e,f;return e=d(a,b),b=_.extend({as:e,prefix:c},b),f=function(){switch(e){case"email":case"file":case"number":case"password":case"phone":case"string":case"url":case"search":return new FormtasticInput.StringFieldHelper(a,b);case"hidden":return new FormtasticInput.HiddenFieldHelper(a,b);case"text":return new FormtasticInput.TextFieldHelper(a,b);case"boolean":case"bool":case"checkbox":case"check_box":return new FormtasticInput.BooleanFieldHelper(a,b);case"select":return new FormtasticInput.SelectFieldHelper(a,b);default:throw new Error("'"+e+"' is not a valid field type.")}}()},a.prototype.createNode=function(){return Formtastic.createNode.apply(this,arguments)},a.prototype.render=function(){var a;return a={label:this._label_node(),input:this.input(),hint:this.hint(),wrapper:this.wrapper()},this.generate(a)},a.prototype._label_node=function(a){var b,d,e;if(!this.label_name())return null;b={tag:"label","class":c(Formtastic.default_label_class,this.attrs,"label_html.class"),"for":this.generated_id()};try{delete this.attrs.label_html["class"]}catch(f){}return e=_.extend(b,this.attrs.label_html),d=this.createNode(e,!0),d.innerHTML=this.label_name()+(this.required?Formtastic.required_string:""),a?d:d.outerHTML},a.prototype.label_name=function(){return this.attrs.label!==!1?this.attrs.label||Formtastic.humanize(this.field):void 0},a.prototype.input=function(a){var b,c,d;return b={placeholder:this.label_name(),tag:"input",type:"string"===this.as?"text":this.as,name:this.input_name(),required:this.required,"class":Formtastic.default_input_class,id:this.generated_id()},b=_.extend(b,a),this.required||delete b.required,d=_.extend(b,this.attrs.input_html),c=this.createNode(d,!0),c.outerHTML},a.prototype.input_name=function(){return this.attrs.input_html&&this.attrs.input_html.name?this.attrs.input_html.name:this.prefix?_.template("<%= prefix %>[<%= name %>]")({prefix:this.prefix,name:this.field}):_.template("<%= name %>")({prefix:this.prefix,name:this.field})},a.prototype.input_value=function(){return null},a.prototype.generated_id=function(){return this.attrs.id?this.attrs.id:_.compact([this.prefix,this.field]).join("_").replace(/\[|\]/g,"_").replace(/\_\_/g,"_").replace(/\s/g,"")},a.prototype.hint=function(){var a;return this.attrs.hint?(a=this.createNode({tag:Formtastic.default_hint_tag,"class":Formtastic.default_hint_class},!0),a.innerHTML=this.attrs.hint,a.outerHTML):null},a.prototype.wrapper=function(){var a,b,d;d=_.compact([this.as,Formtastic.default_wrapper_class,this.required?"required":"optional","input"]).join(" "),d=c(d,this.attrs,"wrapper_html.class");try{delete this.attrs.wrapper_html["class"]}catch(e){}return a={tag:Formtastic.default_wrapper_tag,"class":d,id:this.generated_id()+"_input"},b=_.extend(a,this.attrs.wrapper_html),this.createNode(b,!0)},a.prototype.generate=function(a){return b.apply(this,[a])},a}(),FormtasticInputs=function(){function a(){this.namespace=bind(this.namespace,this),this.actions=bind(this.actions,this),this.inputs=bind(this.inputs,this),this.input=bind(this.input,this),this.container=bind(this.container,this),this.legend=bind(this.legend,this),this.fieldset=bind(this.fieldset,this),this.render=bind(this.render,this),this.createNode=bind(this.createNode,this);var a;a=_.compact(arguments),this.options={},this.cb=void 0,this.nested=!1,this.prefix=void 0,_.each(a,function(a){return function(b,c){return _.isFunction(b)?a.cb=b:_.isBoolean(b)?a.nested=b:_.isObject(b)?(a.options.name||(b.name=b.name?b.name:b.title,delete b.title),_.extend(a.options,b)):_.isString(b)&&0===c?a.options={name:b}:_.isString(b)?a.prefix=b:void 0}}(this)),this.tag="fieldset",this.css_class="inputs"}return a.prototype.createNode=function(){return Formtastic.createNode.apply(this,arguments)},a.prototype.render=function(){var a,b,c,d;return b=this.fieldset(),a=this.container(),c=this.legend(),this.cb&&(a.innerHTML=this.cb.apply(window,[this]),b.innerHTML=c+a.outerHTML),this.nested?(d=this.createNode({tag:Formtastic.default_wrapper_tag},!0),d.innerHTML=b.outerHTML,d.outerHTML):b.outerHTML},a.prototype.fieldset=function(){var a,b;return b={tag:this.tag,"class":this.css_class},a=_.extend(b,this.options),delete a.name,this.createNode(a,!0)},a.prototype.legend=function(){var a;return this.options.name?(a=this.createNode({tag:"legend"},!0),a.innerHTML=this.options.name,a.outerHTML):""},a.prototype.container=function(){return this.createNode({tag:Formtastic.default_fieldset_inner_tag},!0)},a.prototype.input=function(a,b,c,d){return Formtastic.prototype.input.apply(this,[a,b,this.namespace()||c,d])},a.prototype.inputs=function(){var a,b;for(a=[],b=0;b<arguments.length;)a[b]=arguments[b],b++;return a.push(this.namespace()),a.push(!0),Formtastic.prototype.inputs.apply(this,a)},a.prototype.actions=function(){var a,b;return b=_.first(arguments),a=_.last(arguments),Formtastic.prototype.actions.apply(this,[b,a,this.namespace(),!0])},a.prototype.namespace=function(){return this.options["for"]?_.template("<%= prefix %>[<%= name %>]")({prefix:this.prefix,name:this.options["for"]}):_.template("<%= prefix %>")({prefix:this.prefix})},a}(),extend(FormtasticHelpers,FormtasticInputs),FormtasticActions=function(a){function b(a,c,d,e){b.__super__.constructor.call(this,a,c,d,e),this.css_class="actions"}return extend1(b,a),b}(FormtasticInputs),BooleanFieldHelper=function(a){function b(){return this.input=bind(this.input,this),this._label_node=bind(this._label_node,this),b.__super__.constructor.apply(this,arguments)}return extend1(b,a),b.prototype._label_node=function(){return null},b.prototype.input=function(){var a,b,c,d,e,f,g;return a=function(a){return function(){try{return a.attrs.checked_value||a.attrs.value||a.attrs.input_html.value}catch(b){return 1}}}(this),c=function(a){return function(){return a.attrs.unchecked_value||"0"}}(this),b=function(a){return function(b){var d,e;return e=_.clone(a.attrs.input_html),e&&delete e.checked,delete b.required,d=_.extend(b,{type:"hidden",id:null,value:c()}),d=_.extend(d,e),a.createNode(d)}}(this),f={tag:"input",type:"checkbox",name:this.input_name(),required:this.required,id:this.generated_id(),value:a()},this.required||delete f.required,g=_.extend(_.clone(f),this.attrs.input_html),d=this.createNode(g),e=FormtasticInputBase.prototype._label_node.apply(this,[!0]),e.innerHTML=d+" "+this.label_name(),e.className="",b(_.clone(f))+e.outerHTML},b}(FormtasticInputBase),FormtasticInput.BooleanFieldHelper=BooleanFieldHelper,HiddenFieldHelper=function(a){function b(){return this.wrapper=bind(this.wrapper,this),this._label_node=bind(this._label_node,this),b.__super__.constructor.apply(this,arguments)}return extend1(b,a),b.prototype._label_node=function(){return null},b.prototype.wrapper=function(){var a;return a=b.__super__.wrapper.apply(this,arguments),a.setAttribute("style","display: none;"),a},b}(FormtasticInputBase),FormtasticInput.HiddenFieldHelper=HiddenFieldHelper,SelectFieldHelper=function(a){function b(a,c,d){if(this._buildSelectOption=bind(this._buildSelectOption,this),this.input=bind(this.input,this),"undefined"==typeof c.collection)throw new Error("Missing :collection for select box.");b.__super__.constructor.call(this,a,c,d)}return extend1(b,a),b.prototype.input=function(){var a,b,c,d,e,f,g;for(b={placeholder:this.label_name(),tag:"select",name:this.input_name(),"class":Formtastic.default_input_class,id:this.generated_id(),multiple:this.attrs.multiple},a=this.attrs.collection,d=_.extend(b,this.attrs.input_html),c=this.createNode(d,!0),f=0,g=a.length;g>f;f++)e=a[f],c.innerHTML=c.innerHTML+this._buildSelectOption(e);return c.outerHTML},b.prototype._buildSelectOption=function(a){var b;return b=this.createNode({tag:"option"},!0),b.innerHTML=a.text,_.isArray(a)?(b.value=a[1],b.innerHTML=a[0]):_.isObject(a)?(b.value=a.value,a.text?b.innerHTML=a.text:a.label?b.innerHTML=a.label:a.name?b.innerHTML=a.name:a.value):(b.value=a,b.innerHTML=a),b.outerHTML},b}(FormtasticInputBase),FormtasticInput.SelectFieldHelper=SelectFieldHelper,StringFieldHelper=function(a){function b(a,c,d){b.__super__.constructor.call(this,a,c,d)}return extend1(b,a),b}(FormtasticInputBase),FormtasticInput.StringFieldHelper=StringFieldHelper,TextFieldHelper=function(a){function b(a,c,d){this.input=bind(this.input,this),b.__super__.constructor.call(this,a,c,d)}return extend1(b,a),b.prototype.input=function(){var a,b,c,d;return a={placeholder:this.label_name(),tag:"textarea",type:"string"===this.as?"text":this.as,name:this.input_name(),required:this.required,"class":Formtastic.default_input_class,id:this.generated_id()},this.required||delete a.required,c=_.extend(a,this.attrs.input_html),d=c.value||"",delete c.value,delete c.type,delete c.as,b=this.createNode(c,!0),b.innerHTML=d,b.outerHTML},b}(FormtasticInputBase),FormtasticInput.TextFieldHelper=TextFieldHelper}).call(this);